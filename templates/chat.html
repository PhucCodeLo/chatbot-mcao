<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Nh√† H√†ng Ph√∫c ƒê·∫πp Chai</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { background: #fff; min-height: 100vh; }
        .chat-container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 18px; box-shadow: 0 4px 32px #0001; padding: 0; }
        .chat-header { background: #3578e5; color: #fff; padding: 20px 26px; border-radius: 18px 18px 0 0; font-size: 1.3rem; font-weight: bold; letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
        .chat-header i { font-size: 1.5rem; }
        .chat-body { padding: 32px 28px 24px 28px; min-height: 450px; max-height: 75vh; overflow-y: auto; background: #fff; }
        .chat-message { display: flex; align-items: flex-end; margin-bottom: 18px; }
        .chat-message.user { flex-direction: row-reverse; }
        .chat-message .avatar { width: 36px; height: 36px; border-radius: 50%; background: #e4e6eb; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; margin: 0 8px; box-shadow: 0 2px 8px #0001; }
        .chat-message.bot .avatar { background: #3578e5; color: #fff; }
        .chat-message.user .avatar { background: #e4e6eb; color: #3578e5; }
        .chat-message .msg { display: inline-block; padding: 10px 18px; border-radius: 18px; max-width: 75%; font-size: 1.05rem; line-height: 1.5; box-shadow: 0 1px 6px #0001; }
        .chat-message.user .msg { background: #e4e6eb; color: #222; border-bottom-right-radius: 6px; }
        .chat-message.bot .msg { background: #f0f2f5; color: #222; border-bottom-left-radius: 6px; }
        .chat-footer { padding: 16px 22px; border-top: 1px solid #e4e6eb; background: #fff; border-radius: 0 0 18px 18px; }
        .chat-footer form { display: flex; gap: 8px; }
        .chat-footer input { flex: 1; border-radius: 18px; border: 1px solid #e4e6eb; padding: 12px 18px; font-size: 1.05rem; background: #f0f2f5; }
        .chat-footer button { border-radius: 18px; background: #3578e5; color: #fff; border: none; padding: 12px 28px; font-weight: bold; font-size: 1.05rem; transition: background 0.2s; }
        .chat-footer button:active { background: #2851a3; }
        .typing-indicator { color: #888; font-style: italic; margin-left: 48px; margin-bottom: 10px; font-size: 1.01rem; animation: blink 1.2s linear infinite; }
        @keyframes blink { 0%,100%{opacity:0.5;} 50%{opacity:1;} }
        @media (max-width: 600px) {
            .chat-container { max-width: 100vw; border-radius: 0; margin: 0; }
            .chat-header, .chat-footer { padding-left: 8px; padding-right: 8px; }
            .chat-body { padding-left: 4px; padding-right: 4px; }
        }
        /* Modal zoom ·∫£nh */
        .img-modal-bg {
            display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.7); align-items: center; justify-content: center;
        }
        .img-modal-bg.active { display: flex; }
        .img-modal-img {
            max-width: 90vw; max-height: 90vh; border-radius: 12px; box-shadow: 0 8px 32px #0008;
            background: #fff; padding: 8px;
        }
        .img-modal-close {
            position: absolute; top: 32px; right: 48px; color: #fff; font-size: 2.2rem; cursor: pointer; z-index: 10001;
        }
        @media (max-width: 600px) {
            .img-modal-close { top: 12px; right: 18px; font-size: 1.6rem; }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header"><i class="fa-solid fa-bowl-food"></i> MC ·∫¢o Nh√† H√†ng Ph√∫c ƒê·∫πp Chai</div>
        <div class="chat-body" id="chat-body">
            <!-- Chat messages will appear here -->
        </div>
        <div id="typing-indicator" class="typing-indicator" style="display:none;">ü§ñ Chatbot ƒëang suy nghƒ©...</div>
        <div class="chat-footer">
            <form id="chat-form" autocomplete="off">
                <input type="text" id="user-input" placeholder="Nh·∫≠p tin nh·∫Øn..." required autofocus />
                <button type="submit"><i class="fa-solid fa-paper-plane"></i> G·ª≠i</button>
            </form>
        </div>
    </div>
    <!-- Modal zoom ·∫£nh -->
    <div class="img-modal-bg" id="img-modal-bg">
        <span class="img-modal-close" id="img-modal-close">&times;</span>
        <img id="img-modal-img" class="img-modal-img" src="" alt="·∫¢nh l·ªõn">
    </div>
    <script>
        const chatBody = document.getElementById('chat-body');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const typingIndicator = document.getElementById('typing-indicator');
        const imgModalBg = document.getElementById('img-modal-bg');
        const imgModalImg = document.getElementById('img-modal-img');
        const imgModalClose = document.getElementById('img-modal-close');

        function appendMessage(sender, text) {
            // N·∫øu l√† bot v√† c√≥ d·∫°ng danh s√°ch m√≥n, l√†m ƒë·∫πp l·∫°i
            if (sender === 'bot' && /-\s*([^-\n]+)\(.+\):/g.test(text)) {
                // T√°ch t·ª´ng d√≤ng, l√†m n·ªïi b·∫≠t t√™n m√≥n
                text = text.replace(/-\s*([^\(\n]+)\s*\(([^\)]+)\):\s*([^\n]+)/g, function(_, tenMon, vungMien, moTa) {
                    return `<div style="margin-bottom:10px;"><span style="font-weight:bold;color:#3578e5;">${tenMon.trim()}</span> <span style="color:#888;font-size:0.97em;">(${vungMien.trim()})</span>: <span style="color:#222;">${moTa.trim()}</span></div>`;
                });
            } else {
                // Xu·ªëng d√≤ng b√¨nh th∆∞·ªùng
                text = text.replace(/\n/g, '<br>');
            }
            const msgDiv = document.createElement('div');
            msgDiv.className = 'chat-message ' + sender;
            let avatar = '';
            if (sender === 'user') {
                // ƒê·ªïi icon user sang avatar h√¨nh ng∆∞·ªùi m·ªÅm m·∫°i h∆°n (fa-user-astronaut)
                avatar = '<span class="avatar"><i class="fa-solid fas fa-user-alt"></i></span>';
            } else {
                avatar = '<span class="avatar"><i class="fa-solid fa-robot"></i></span>';
            }
            msgDiv.innerHTML = `${avatar}<span class="msg">${text}</span>`;
            chatBody.appendChild(msgDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Hi·ªÉn th·ªã l·ªùi ch√†o bot khi load trang, kh√¥ng g·ª≠i message r·ªóng l√™n server
        window.onload = function() {
            appendMessage('bot', 'Ch√†o kh√°ch iu! T·ªõ l√† MC ·∫£o c·ªßa nh√† h√†ng Ph√∫c ƒê·∫πp Chai, s·∫µn s√†ng gi√∫p b·∫°n v·ªõi c√°c m√≥n ƒÉn, th·ª±c ƒë∆°n, v√† m·ªçi th·∫Øc m·∫Øc v·ªÅ nh√† h√†ng. B·∫°n c·∫ßn h·ªèi g√¨ c·ª© tho·∫£i m√°i nh√©!');
        };

        chatForm.onsubmit = function(e) {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;
            appendMessage('user', text);
            userInput.value = '';
            typingIndicator.style.display = 'block';
            fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            })
            .then(res => res.json())
            .then(data => {
                typingIndicator.style.display = 'none';
                appendMessage('bot', data.bot);
            })
            .catch(() => {
                typingIndicator.style.display = 'none';
                appendMessage('bot', 'Xin l·ªói, c√≥ l·ªói x·∫£y ra.');
            });
        };

        // Modal zoom ·∫£nh khi click v√†o .zoomable-img
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('zoomable-img')) {
                const modalBg = document.getElementById('img-modal-bg');
                const modalImg = document.getElementById('img-modal-img');
                modalImg.src = e.target.src;
                modalImg.alt = e.target.alt || '';
                modalBg.classList.add('active');
            }
        });
        document.getElementById('img-modal-close').onclick = function() {
            document.getElementById('img-modal-bg').classList.remove('active');
        };
        document.getElementById('img-modal-bg').onclick = function(e) {
            if (e.target === this) this.classList.remove('active');
        };
    </script>
</body>
</html>
